import{a as Be,b as Ee}from"./chunk-3DZELCDE.js";import{a as ke}from"./chunk-W66C6N3I.js";import{a as P}from"./chunk-S77TKC5Z.js";import{a as H}from"./chunk-BPDZKKEV.js";import"./chunk-G4CQK3SC.js";import{a as Ne,b as Oe,c as G}from"./chunk-O6KRAR5Q.js";import{a as Ge,b as Pe}from"./chunk-5TNR2OTO.js";import{f as Re,g as Ve,i as Le,k as He,l as De}from"./chunk-UEBDUWVO.js";import{d as V,e as L,h as xe}from"./chunk-WNPWYFNT.js";import{c as D}from"./chunk-QPXJIEBY.js";import{$ as T,Ae as we,Be as Te,Ce as Ie,Da as oe,De as Me,E as U,Ea as v,Fa as re,Ga as u,H as Y,Ia as ae,Ja as M,K,Ka as k,L as E,La as j,M as N,Ma as A,Na as F,Oa as c,Pa as l,Qa as b,Ra as se,Rc as ve,S as J,Sa as ce,Sc as fe,Tc as Ce,Ua as g,Uc as be,Wa as le,Xa as d,Ya as a,_ as O,aa as X,ab as ue,ba as ee,bb as me,cb as pe,db as $,eb as h,fa as m,g as z,ga as p,gb as y,ka as te,kb as de,lb as _e,mb as Z,me as Se,n as q,nb as f,qa as I,sb as he,ta as ie,tb as R,va as s,vb as ge,wa as _,x as Q,ya as ne,ze as ye}from"./chunk-VIQ542NQ.js";var B=class{static isMobile(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Mobile|mobile|CriOS/i.test(navigator.userAgent)}};var Ue=["tuiSidebar",""];function Ye(t,r){if(t&1&&(se(0),h(1),ce()),t&2){let e=r.polymorpheusOutlet;s(),y(" ",e," ")}}var W=(()=>{class t extends fe{constructor(e,i,n,o){super(e,o),this.content=e,this.injector=i,this.portalService=n,this.component=new ve(Ke,this.injector),this.sidebarRef=null,this.direction="left",this.autoWidth=!1}set tuiSidebar(e){e?this.show():this.hide()}ngOnDestroy(){this.hide()}show(){this.sidebarRef===null&&(this.sidebarRef=this.portalService.add(this.component),this.sidebarRef.changeDetectorRef.detectChanges())}hide(){this.sidebarRef!==null&&(this.portalService.remove(this.sidebarRef),this.sidebarRef=null)}}return t.\u0275fac=function(e){return new(e||t)(_(ne),_(te),_(ke),_(R))},t.\u0275dir=ee({type:t,selectors:[["","tuiSidebar",""]],inputs:{direction:[O.None,"tuiSidebarDirection","direction"],autoWidth:[O.None,"tuiSidebarAutoWidth","autoWidth"],tuiSidebar:"tuiSidebar"},features:[oe]}),t})(),Ke=(()=>{class t{constructor(e,i){this.options=e,this.directive=i,this.left=Object.assign(Object.assign({},this.options),{value:"left"}),this.right=Object.assign(Object.assign({},this.options),{value:"right"})}get animation(){return this.direction==="left"?this.left:this.right}get directionHostClass(){return`t-${this.directive.direction}`}get direction(){return this.directive.direction}get content(){return this.directive.content}get autoWidth(){return this.directive.autoWidth}ngDoCheck(){this.directive.check()}}return t.\u0275fac=function(e){return new(e||t)(_(Se),_(W))},t.\u0275cmp=T({type:t,selectors:[["aside","tuiSidebar",""]],hostVars:3,hostBindings:function(e,i){e&2&&(le("@tuiSlideIn",i.animation),M(i.directionHostClass))},attrs:Ue,decls:2,vars:3,consts:[["tuiActiveZone","",1,"t-wrapper"],[4,"polymorpheusOutlet"]],template:function(e,i){e&1&&(c(0,"div",0),v(1,Ye,2,1,"ng-container",1),l()),e&2&&(ae("t-wrapper_auto-width",i.autoWidth),s(),u("polymorpheusOutlet",i.content))},dependencies:[V,Ce],styles:['[_nghost-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;display:flex}[_nghost-%COMP%]:before, [_nghost-%COMP%]:after{position:absolute;top:0;left:0;width:100%;content:"";height:100%;background:rgba(0,0,0,.38);animation:tuiFadeIn var(--tui-duration)}[_nghost-%COMP%]:before{left:-100%;width:200%}[_nghost-%COMP%]:after{left:100%}.ng-animating[_nghost-%COMP%]:before, .ng-animating[_nghost-%COMP%]:after{opacity:0;transition:opacity var(--tui-duration)}.t-right[_nghost-%COMP%]{justify-content:flex-end}.t-left[_nghost-%COMP%]{justify-content:flex-start}.t-wrapper[_ngcontent-%COMP%]{position:relative;display:flex;flex-direction:column;background:var(--tui-base-01);box-shadow:0 10rem var(--tui-base-01);width:17.25rem}.t-wrapper_auto-width[_ngcontent-%COMP%]{width:auto}'],data:{animation:[xe]},changeDetection:0}),t})(),je=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=X({type:t}),t.\u0275inj=J({imports:[[L,be]]}),t})();var Je=["header"],Ae=t=>({dark:t}),x=t=>[t],Fe=()=>({toBookmark:!0});function Xe(t,r){if(t&1){let e=g();c(0,"a",11)(1,"button",12),d("click",function(n){m(e);let o=a(3);return p(o.onNavigate(n))}),h(2," Back to Route Chapters "),l()()}if(t&2){let e=a(3);u("routerLink",f(1,x,e.toChaptersLink))}}function et(t,r){if(t&1){let e=g();c(0,"a",13)(1,"button",12),d("click",function(n){m(e);let o=a(3);return p(o.onNavigate(n))}),h(2," Go to Bookmark "),l()()}if(t&2){let e=a(3);u("routerLink",f(2,x,e.bookmarkLink))("queryParams",Z(4,Fe))}}function tt(t,r){if(t&1){let e=g();c(0,"a",11)(1,"button",12),d("click",function(n){m(e);let o=a(3);return p(o.onNavigate(n))}),h(2),l()()}if(t&2){let e=r.$implicit;u("routerLink",f(2,x,e.link)),s(2),y(" ",e.name," ")}}function it(t,r){if(t&1){let e=g();c(0,"div",9)(1,"div",10)(2,"a",11)(3,"button",12),d("click",function(n){m(e);let o=a(2);return p(o.onNavigate(n))}),h(4," Home "),l()(),c(5,"a",11)(6,"button",12),d("click",function(n){m(e);let o=a(2);return p(o.onNavigate(n))}),h(7," Search "),l()(),v(8,Xe,3,3,"a",11)(9,et,3,5,"a",13),c(10,"button",14),d("click",function(){m(e);let n=a(2),o=$(5);return p(n.showGameHelp(o))}),h(11," Show Game Info "),l(),A(12,tt,3,4,"a",11,j),c(14,"a",11)(15,"button",12),d("click",function(n){m(e);let o=a(2);return p(o.onNavigate(n))}),h(16," Settings "),l()()()()}if(t&2){let e=a(2);u("ngClass",f(6,Ae,e.night.value)),s(2),u("routerLink","/games"),s(3),u("routerLink","search"),s(3),k(8,e.toChaptersLink?8:-1),s(),k(9,e.bookmarkLink?9:-1),s(3),F(e.menuItems),s(2),u("routerLink","/settings")}}function nt(t,r){if(t&1){let e=g();c(0,"button",4),d("click",function(){m(e);let n=a();return p(n.toggle(!0))})("tuiActiveZoneChange",function(n){m(e);let o=a();return p(o.toggle(n))}),v(1,it,17,8,"div",5),l(),b(2,"div",6)(3,"h2",7)(4,"div",6),c(5,"button",8),d("click",function(){m(e);let n=a();return p(n.night.toggle())}),l()}if(t&2){let e=a();s(),u("tuiSidebar",e.sideBarOpen)("tuiSidebarDirection","left"),s(2),u("innerHTML",e.displayName,I),s(2),u("icon",e.night.value?"tuiIconSunLarge":"tuiIconMoonLarge")("tuiHint",e.night.value?"Switch to light mode":"Switch to night mode")}}function ot(t,r){if(t&1){let e=g();c(0,"a",11)(1,"button",12),d("click",function(n){m(e);let o=a(3);return p(o.onNavigate(n))}),h(2," Back to Route Chapters "),l()()}if(t&2){let e=a(3);u("routerLink",f(1,x,e.toChaptersLink))}}function rt(t,r){if(t&1){let e=g();c(0,"a",11)(1,"button",12),d("click",function(n){m(e);let o=a(3);return p(o.onNavigate(n))}),h(2),l()()}if(t&2){let e=r.$implicit;u("routerLink",f(2,x,e.link)),s(2),y(" ",e.name," ")}}function at(t,r){if(t&1){let e=g();c(0,"a",13)(1,"button",12),d("click",function(n){m(e);let o=a(3);return p(o.onNavigate(n))}),h(2," Go to Bookmark "),l()()}if(t&2){let e=a(3);u("routerLink",f(2,x,e.bookmarkLink))("queryParams",Z(4,Fe))}}function st(t,r){if(t&1&&(c(0,"div",9)(1,"div",10),v(2,ot,3,3,"a",11),A(3,rt,3,4,"a",11,j),v(5,at,3,5,"a",13),l()()),t&2){let e=a(2);u("ngClass",f(3,Ae,e.night.value)),s(2),k(2,e.toChaptersLink?2:-1),s(),F(e.menuItems),s(2),k(5,e.bookmarkLink?5:-1)}}function ct(t,r){if(t&1){let e=g();c(0,"button",4),d("click",function(){m(e);let n=a();return p(n.toggle(!0))})("tuiActiveZoneChange",function(n){m(e);let o=a();return p(o.toggle(n))}),v(1,st,6,5,"div",5),l(),c(2,"a",15),b(3,"button",16),l(),c(4,"a",15),b(5,"button",17),l(),b(6,"div",6)(7,"h2",7)(8,"div",6),c(9,"button",18),d("click",function(){m(e);let n=a(),o=$(5);return p(n.showGameHelp(o))}),l(),c(10,"a",15),b(11,"button",19),l(),c(12,"button",8),d("click",function(){m(e);let n=a();return p(n.night.toggle())}),l()}if(t&2){let e=a();s(),u("tuiSidebar",e.sideBarOpen)("tuiSidebarDirection","left"),s(),u("routerLink","/games"),s(2),u("routerLink","search"),s(3),u("innerHTML",e.displayName,I),s(3),u("routerLink","/settings"),s(2),u("icon",e.night.value?"tuiIconSunLarge":"tuiIconMoonLarge")("tuiHint",e.night.value?"Switch to light mode":"Switch to night mode")}}function lt(t,r){if(t&1){let e=g();b(0,"ng-component",20),c(1,"button",21),d("click",function(){let n=m(e).$implicit;return p(n.complete())}),h(2," Close "),l()}if(t&2){let e=a();u("innerHTML",e.dialogueTxt,I)}}var $t=(()=>{let r=class r{get classes(){let i=["root"];return this.night.value&&i.push("dark"),i}get mode(){return this.night.value?"onDark":null}constructor(i,n,o,C,w,$e,Ze,We,ze){this.route=i,this.router=n,this.rootService=o,this.apiService=C,this.sakura=w,this.cdr=$e,this.dialogs=Ze,this.theme=We,this.night=ze,this.displayName="",this.sideBarOpen=!1,this.menuItems=[],this.isMobile=!1,this.toChaptersLink="",this.bookmarkLink="",this.gameName="",this.unsubscribe=new z,this.dialogueTxt="",this.prevScrollPos=window.scrollY,this.change$=this.night,this.night$=this.change$.pipe(K(null),q(()=>this.night.value),U(),Y()),this.router.events.pipe(Q(S=>S instanceof ye)).subscribe(()=>{let S=this.route.firstChild?.snapshot.params;S?.chapterNumber&&S?.routeName?this.toChaptersLink=`routes/${S?.routeName}`:this.toChaptersLink=""})}ngOnInit(){this.isMobile=B.isMobile(),this.sakura.bindSakura("game-root"),this.rootService.getHeader().pipe(N(this.unsubscribe)).subscribe(i=>{this.displayName=this.addBreaks(i),this.cdr.detectChanges()}),this.rootService.getBookmarkState().pipe(N(this.unsubscribe)).subscribe(()=>{this.initBookmarkLink()}),this.route.paramMap.pipe(E(i=>(this.gameName=i.get("gameName")||"",this.initBookmarkLink(),this.apiService.get("gameConfig",{pathParams:{gameName:this.gameName}})))).subscribe(i=>{this.menuItems=i})}ngAfterViewInit(){this.initSettings()}toggle(i){this.sideBarOpen=i}onNavigate(i){i.stopPropagation(),this.sideBarOpen=!1}routerActivate(){window.scroll(0,0)}showGameHelp(i){this.apiService.get("gameInfo",{pathParams:{gameName:this.gameName},requestOptions:{responseType:"text"}}).pipe(E(n=>(this.dialogueTxt=n,this.dialogs.open(i)))).subscribe()}addBreaks(i){return i.replace("\u2605","<wbr/>\u2605<wbr/>").replace(";","<wbr/>;<wbr/>")}onScroll(i){let n=window.scrollY;this.prevScrollPos>n?this.headerEl.nativeElement.style.top="0":this.headerEl.nativeElement.style.top=`-${this.headerEl.nativeElement.offsetHeight}px`,this.prevScrollPos=n}initBookmarkLink(){let i=D.bookmarkTemplateKey.replace("{gameName}",this.gameName),n=localStorage.getItem(i);if(!n){this.bookmarkLink="";return}let o=n.split(":");o.length==3&&(this.bookmarkLink=`routes/${o[0]}/${o[1]}`),o.length==2&&(this.bookmarkLink=`chapters/${o[0]}`)}initSettings(){let i=document.getElementsByTagName("game-root")[0],n=localStorage.getItem(D.hideSpoilers);n==null||n=="true"?(i.style.setProperty("--spoiler-color","gray"),i.style.setProperty("--spoiler-background","gray")):(i.style.setProperty("--spoiler-color","unset"),i.style.setProperty("--spoiler-background","unset"));let o=localStorage.getItem(D.fontSizeMul);o==null?i.style.setProperty("--reading-font-size","1rem"):i.style.setProperty("--reading-font-size",`${o}rem`)}};r.\u0275fac=function(n){return new(n||r)(_(we),_(Ie),_(H),_(P),_(G),_(R),_(Be),_(Ne),_(Oe))},r.\u0275cmp=T({type:r,selectors:[["game-root"]],viewQuery:function(n,o){if(n&1&&ue(Je,5),n&2){let C;me(C=pe())&&(o.headerEl=C.first)}},hostVars:3,hostBindings:function(n,o){n&1&&d("scroll",function(w){return o.onScroll(w)},!1,ie),n&2&&(re("data-mode",o.mode),M(o.classes))},standalone:!0,features:[de([P,H,G]),_e],decls:7,vars:1,consts:[["header",""],["dialogTemplate",""],[1,"game-root_header"],[3,"activate"],["icon","tuiIconMenuLarge","tuiIconButton","","appearance","icon",3,"click","tuiActiveZoneChange"],["class","root",3,"ngClass",4,"tuiSidebar","tuiSidebarDirection"],[1,"spacer"],[1,"game-root_header-text",3,"innerHTML"],["tuiIconButton","","appearance","icon","tuiHintAppearance","onDark",3,"click","icon","tuiHint"],[1,"root",3,"ngClass"],[1,"game-root_panel"],[1,"game-root_side-panel-button",3,"routerLink"],["appearance","custom","tuiButton","","type","button",3,"click"],[1,"game-root_side-panel-button",3,"routerLink","queryParams"],["appearance","custom","tuiButton","","type","button",1,"game-root_side-panel-button",3,"click"],[3,"routerLink"],["icon","tuiIconHomeLarge","tuiIconButton","","appearance","icon","tuiHint","To game list","tuiHintAppearance","onDark"],["icon","tuiIconSearchLarge","tuiIconButton","","appearance","icon","tuiHint","Search","tuiHintAppearance","onDark"],["icon","tuiIconHelpCircleLarge","tuiIconButton","","appearance","icon","tuiHint","Game Info","tuiHintAppearance","onDark",3,"click"],["icon","tuiIconSettingsLarge","tuiIconButton","","appearance","icon","tuiHint","Global Settings","tuiHintAppearance","onDark"],[3,"innerHTML"],["size","m","tuiButton","","appearance","custom","type","button",3,"click"]],template:function(n,o){if(n&1){let C=g();c(0,"div",2,0),v(2,nt,6,5)(3,ct,13,8),l(),v(4,lt,3,1,"ng-template",null,1,he),c(6,"router-outlet",3),d("activate",function(){return m(C),p(o.routerActivate())}),l()}n&2&&(s(2),k(2,o.isMobile?2:3))},dependencies:[ge,Te,Me,Ee,je,W,Pe,Ge,De,Re,He,Ve,Le,L,V],encapsulation:2});let t=r;return t})();export{$t as GameRootComponent};
