import{a as De,b as Ee}from"./chunk-E7BXRFE6.js";import{a as we}from"./chunk-VHQZ63EU.js";import{a as E}from"./chunk-Y2ZDU5CO.js";import{a as G}from"./chunk-U4XC2GOP.js";import"./chunk-G4CQK3SC.js";import{a as Ne,b as Oe,c as D}from"./chunk-BZ35IFDC.js";import{a as Ge,b as Pe}from"./chunk-UFRAF5IV.js";import{f as Re,g as Me,i as Ve,k as Le,l as He}from"./chunk-XLIKHLUI.js";import{d as L,e as H,h as Te}from"./chunk-JJAHF3FC.js";import{c as P}from"./chunk-QPXJIEBY.js";import{$ as T,$a as y,Da as te,E as z,Ea as v,Fa as ie,Ga as r,H as q,Ia as ne,Ja as R,Jb as he,K as Q,Ka as l,Kb as fe,L as O,La as u,Lb as ve,M as B,Ma as k,Mb as be,Na as oe,Nb as ke,Oa as re,Pa as ae,Qa as h,S as U,Sa as se,Ta as _,Tc as Ce,Ua as s,Uc as xe,Vc as Se,Wc as ye,Ya as ce,Za as le,_ as j,_a as ue,aa as Y,ab as g,ba as K,cb as w,fa as m,g as $,ga as p,gb as me,hb as pe,ib as A,jb as b,ka as J,n as Z,ob as M,oe as Ie,pb as V,qa as I,rb as _e,ta as X,tb as de,ub as ge,va as c,wa as d,x as W,ya as ee}from"./chunk-KN6KQJWB.js";var N=class{static isMobile(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Mobile|mobile|CriOS/i.test(navigator.userAgent)}};var Qe=["tuiSidebar",""];function Ue(t,a){if(t&1&&(oe(0),g(1),re()),t&2){let e=a.polymorpheusOutlet;c(),w(" ",e," ")}}var F=(()=>{class t extends xe{constructor(e,i,n,o){super(e,o),this.content=e,this.injector=i,this.portalService=n,this.component=new Ce(Ye,this.injector),this.sidebarRef=null,this.direction="left",this.autoWidth=!1}set tuiSidebar(e){e?this.show():this.hide()}ngOnDestroy(){this.hide()}show(){this.sidebarRef===null&&(this.sidebarRef=this.portalService.add(this.component),this.sidebarRef.changeDetectorRef.detectChanges())}hide(){this.sidebarRef!==null&&(this.portalService.remove(this.sidebarRef),this.sidebarRef=null)}}return t.\u0275fac=function(e){return new(e||t)(d(ee),d(J),d(we),d(V))},t.\u0275dir=K({type:t,selectors:[["","tuiSidebar",""]],inputs:{direction:[j.None,"tuiSidebarDirection","direction"],autoWidth:[j.None,"tuiSidebarAutoWidth","autoWidth"],tuiSidebar:"tuiSidebar"},features:[te]}),t})(),Ye=(()=>{class t{constructor(e,i){this.options=e,this.directive=i,this.left=Object.assign(Object.assign({},this.options),{value:"left"}),this.right=Object.assign(Object.assign({},this.options),{value:"right"})}get animation(){return this.direction==="left"?this.left:this.right}get directionHostClass(){return`t-${this.directive.direction}`}get direction(){return this.directive.direction}get content(){return this.directive.content}get autoWidth(){return this.directive.autoWidth}ngDoCheck(){this.directive.check()}}return t.\u0275fac=function(e){return new(e||t)(d(Ie),d(F))},t.\u0275cmp=T({type:t,selectors:[["aside","tuiSidebar",""]],hostVars:3,hostBindings:function(e,i){e&2&&(se("@tuiSlideIn",i.animation),R(i.directionHostClass))},attrs:Qe,decls:2,vars:3,consts:[["tuiActiveZone","",1,"t-wrapper"],[4,"polymorpheusOutlet"]],template:function(e,i){e&1&&(l(0,"div",0),v(1,Ue,2,1,"ng-container",1),u()),e&2&&(ne("t-wrapper_auto-width",i.autoWidth),c(),r("polymorpheusOutlet",i.content))},dependencies:[L,Se],styles:['[_nghost-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;display:flex}[_nghost-%COMP%]:before, [_nghost-%COMP%]:after{position:absolute;top:0;left:0;width:100%;content:"";height:100%;background:rgba(0,0,0,.38);animation:tuiFadeIn var(--tui-duration)}[_nghost-%COMP%]:before{left:-100%;width:200%}[_nghost-%COMP%]:after{left:100%}.ng-animating[_nghost-%COMP%]:before, .ng-animating[_nghost-%COMP%]:after{opacity:0;transition:opacity var(--tui-duration)}.t-right[_nghost-%COMP%]{justify-content:flex-end}.t-left[_nghost-%COMP%]{justify-content:flex-start}.t-wrapper[_ngcontent-%COMP%]{position:relative;display:flex;flex-direction:column;background:var(--tui-base-01);box-shadow:0 10rem var(--tui-base-01);width:17.25rem}.t-wrapper_auto-width[_ngcontent-%COMP%]{width:auto}'],data:{animation:[Te]},changeDetection:0}),t})(),Be=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Y({type:t}),t.\u0275inj=U({imports:[[H,ye]]}),t})();var Ke=["header"],je=t=>({dark:t}),x=t=>[t],Ae=()=>({toBookmark:!0});function Je(t,a){t&1&&ae(0)}function Xe(t,a){if(t&1){let e=h();l(0,"a",22)(1,"button",23),_("click",function(n){m(e);let o=s(3);return p(o.onNavigate(n))}),g(2," Back to Route Chapters "),u()()}if(t&2){let e=s(3);r("routerLink",b(1,x,e.toChaptersLink))}}function et(t,a){if(t&1){let e=h();l(0,"a",22)(1,"button",23),_("click",function(n){m(e);let o=s(3);return p(o.onNavigate(n))}),g(2),u()()}if(t&2){let e=a.$implicit;r("routerLink",b(2,x,e.link)),c(2),w(" ",e.name," ")}}function tt(t,a){if(t&1){let e=h();l(0,"a",24)(1,"button",23),_("click",function(n){m(e);let o=s(3);return p(o.onNavigate(n))}),g(2," Go to Bookmark "),u()()}if(t&2){let e=s(3);r("routerLink",b(2,x,e.bookmarkLink))("queryParams",A(4,Ae))}}function it(t,a){if(t&1&&(l(0,"div",17)(1,"div",18),v(2,Xe,3,3,"a",19)(3,et,3,4,"a",20)(4,tt,3,5,"a",21),u()()),t&2){let e=s(2);r("ngClass",b(4,je,e.night.value)),c(2),r("ngIf",e.toChaptersLink),c(),r("ngForOf",e.menuItems),c(),r("ngIf",e.bookmarkLink)}}function nt(t,a){if(t&1){let e=h();l(0,"button",7),_("click",function(){m(e);let n=s();return p(n.toggle(!0))})("tuiActiveZoneChange",function(n){m(e);let o=s();return p(o.toggle(n))}),v(1,it,5,6,"div",8),u(),l(2,"a",9),k(3,"button",10),u(),l(4,"a",9),k(5,"button",11),u(),k(6,"div",12)(7,"h2",13)(8,"div",12),l(9,"button",14),_("click",function(){m(e);let n=s(),o=y(8);return p(n.showGameHelp(o))}),u(),l(10,"a",9),k(11,"button",15),u(),l(12,"button",16),_("click",function(){m(e);let n=s();return p(n.night.toggle())}),u()}if(t&2){let e=s();c(),r("tuiSidebar",e.sideBarOpen)("tuiSidebarDirection","left"),c(),r("routerLink","/games"),c(2),r("routerLink","search"),c(3),r("innerHTML",e.displayName,I),c(3),r("routerLink","/settings"),c(2),r("icon",e.night.value?"tuiIconSunLarge":"tuiIconMoonLarge")("tuiHint",e.night.value?"Switch to light mode":"Switch to night mode")}}function ot(t,a){if(t&1){let e=h();l(0,"a",22)(1,"button",23),_("click",function(n){m(e);let o=s(3);return p(o.onNavigate(n))}),g(2," Back to Route Chapters "),u()()}if(t&2){let e=s(3);r("routerLink",b(1,x,e.toChaptersLink))}}function rt(t,a){if(t&1){let e=h();l(0,"a",24)(1,"button",23),_("click",function(n){m(e);let o=s(3);return p(o.onNavigate(n))}),g(2," Go to Bookmark "),u()()}if(t&2){let e=s(3);r("routerLink",b(2,x,e.bookmarkLink))("queryParams",A(4,Ae))}}function at(t,a){if(t&1){let e=h();l(0,"a",22)(1,"button",23),_("click",function(n){m(e);let o=s(3);return p(o.onNavigate(n))}),g(2),u()()}if(t&2){let e=a.$implicit;r("routerLink",b(2,x,e.link)),c(2),w(" ",e.name," ")}}function st(t,a){if(t&1){let e=h();l(0,"div",17)(1,"div",18)(2,"a",22)(3,"button",23),_("click",function(n){m(e);let o=s(2);return p(o.onNavigate(n))}),g(4," Home "),u()(),l(5,"a",22)(6,"button",23),_("click",function(n){m(e);let o=s(2);return p(o.onNavigate(n))}),g(7," Search "),u()(),v(8,ot,3,3,"a",19)(9,rt,3,5,"a",21),l(10,"button",25),_("click",function(){m(e);let n=s(2),o=y(8);return p(n.showGameHelp(o))}),g(11," Show Game Info "),u(),v(12,at,3,4,"a",20),l(13,"a",22)(14,"button",23),_("click",function(n){m(e);let o=s(2);return p(o.onNavigate(n))}),g(15," Settings "),u()()()()}if(t&2){let e=s(2);r("ngClass",b(7,je,e.night.value)),c(2),r("routerLink","/games"),c(3),r("routerLink","search"),c(3),r("ngIf",e.toChaptersLink),c(),r("ngIf",e.bookmarkLink),c(3),r("ngForOf",e.menuItems),c(),r("routerLink","/settings")}}function ct(t,a){if(t&1){let e=h();l(0,"button",7),_("click",function(){m(e);let n=s();return p(n.toggle(!0))})("tuiActiveZoneChange",function(n){m(e);let o=s();return p(o.toggle(n))}),v(1,st,16,9,"div",8),u(),k(2,"div",12)(3,"h2",13)(4,"div",12),l(5,"button",16),_("click",function(){m(e);let n=s();return p(n.night.toggle())}),u()}if(t&2){let e=s();c(),r("tuiSidebar",e.sideBarOpen)("tuiSidebarDirection","left"),c(2),r("innerHTML",e.displayName,I),c(2),r("icon",e.night.value?"tuiIconSunLarge":"tuiIconMoonLarge")("tuiHint",e.night.value?"Switch to light mode":"Switch to night mode")}}function lt(t,a){if(t&1){let e=h();k(0,"ng-component",26),l(1,"button",27),_("click",function(){let n=m(e).$implicit;return p(n.complete())}),g(2," Close "),u()}if(t&2){let e=s();r("innerHTML",e.dialogueTxt,I)}}var $t=(()=>{let a=class a{get classes(){let i=["root"];return this.night.value&&i.push("dark"),i}get mode(){return this.night.value?"onDark":null}constructor(i,n,o,f,C,Fe,$e,Ze,We){this.route=i,this.router=n,this.rootService=o,this.apiService=f,this.sakura=C,this.cdr=Fe,this.dialogs=$e,this.theme=Ze,this.night=We,this.displayName="",this.sideBarOpen=!1,this.menuItems=[],this.isMobile=!1,this.toChaptersLink="",this.bookmarkLink="",this.gameName="",this.unsubscribe=new $,this.dialogueTxt="",this.prevScrollPos=window.scrollY,this.change$=this.night,this.night$=this.change$.pipe(Q(null),Z(()=>this.night.value),z(),q()),this.router.events.pipe(W(S=>S instanceof he)).subscribe(()=>{let S=this.route.firstChild?.snapshot.params;S?.chapterNumber&&S?.routeName?this.toChaptersLink=`routes/${S?.routeName}`:this.toChaptersLink=""})}ngOnInit(){this.isMobile=N.isMobile(),this.sakura.bindSakura("game-root"),this.rootService.getHeader().pipe(B(this.unsubscribe)).subscribe(i=>{this.displayName=this.addBreaks(i),this.cdr.detectChanges()}),this.rootService.getBookmarkState().pipe(B(this.unsubscribe)).subscribe(()=>{this.initBookmarkLink()}),this.route.paramMap.pipe(O(i=>(this.gameName=i.get("gameName")||"",this.initBookmarkLink(),this.apiService.get("gameConfig",{pathParams:{gameName:this.gameName}})))).subscribe(i=>{this.menuItems=i})}ngAfterViewInit(){this.initSettings()}toggle(i){this.sideBarOpen=i}onNavigate(i){i.stopPropagation(),this.sideBarOpen=!1}routerActivate(){window.scroll(0,0)}showGameHelp(i){this.apiService.get("gameInfo",{pathParams:{gameName:this.gameName},requestOptions:{responseType:"text"}}).pipe(O(n=>(this.dialogueTxt=n,this.dialogs.open(i)))).subscribe()}addBreaks(i){return i.replace("\u2605","<wbr/>\u2605<wbr/>").replace(";","<wbr/>;<wbr/>")}onScroll(i){let n=window.scrollY;this.prevScrollPos>n?this.headerEl.nativeElement.style.top="0":this.headerEl.nativeElement.style.top=`-${this.headerEl.nativeElement.offsetHeight}px`,this.prevScrollPos=n}initBookmarkLink(){let i=P.bookmarkTemplateKey.replace("{gameName}",this.gameName),n=localStorage.getItem(i);if(!n){this.bookmarkLink="";return}let o=n.split(":");o.length==3&&(this.bookmarkLink=`routes/${o[0]}/${o[1]}`),o.length==2&&(this.bookmarkLink=`chapters/${o[0]}`)}initSettings(){let i=document.getElementsByTagName("game-root")[0],n=localStorage.getItem(P.hideSpoilers);n==null||n=="true"?(i.style.setProperty("--spoiler-color","gray"),i.style.setProperty("--spoiler-background","gray")):(i.style.setProperty("--spoiler-color","unset"),i.style.setProperty("--spoiler-background","unset"));let o=localStorage.getItem(P.fontSizeMul);o==null?i.style.setProperty("--reading-font-size","1rem"):i.style.setProperty("--reading-font-size",`${o}rem`)}};a.\u0275fac=function(n){return new(n||a)(d(fe),d(be),d(G),d(E),d(D),d(V),d(De),d(Ne),d(Oe))},a.\u0275cmp=T({type:a,selectors:[["game-root"]],viewQuery:function(n,o){if(n&1&&ce(Ke,5),n&2){let f;le(f=ue())&&(o.headerEl=f.first)}},hostVars:3,hostBindings:function(n,o){n&1&&_("scroll",function(C){return o.onScroll(C)},!1,X),n&2&&(ie("data-mode",o.mode),R(o.classes))},standalone:!0,features:[me([E,G,D]),pe],decls:10,vars:3,consts:[["header",""],["desktopHeader",""],["mobileHeader",""],["dialogTemplate",""],[1,"game-root_header"],[4,"ngIf","ngIfThen","ngIfElse"],[3,"activate"],["icon","tuiIconMenuLarge","tuiIconButton","","appearance","icon",3,"click","tuiActiveZoneChange"],["class","root",3,"ngClass",4,"tuiSidebar","tuiSidebarDirection"],[3,"routerLink"],["icon","tuiIconHomeLarge","tuiIconButton","","appearance","icon","tuiHint","To game list","tuiHintAppearance","onDark"],["icon","tuiIconSearchLarge","tuiIconButton","","appearance","icon","tuiHint","Search","tuiHintAppearance","onDark"],[1,"spacer"],[1,"game-root_header-text",3,"innerHTML"],["icon","tuiIconHelpCircleLarge","tuiIconButton","","appearance","icon","tuiHint","Game Info","tuiHintAppearance","onDark",3,"click"],["icon","tuiIconSettingsLarge","tuiIconButton","","appearance","icon","tuiHint","Global Settings","tuiHintAppearance","onDark"],["tuiIconButton","","appearance","icon","tuiHintAppearance","onDark",3,"click","icon","tuiHint"],[1,"root",3,"ngClass"],[1,"game-root_panel"],["class","game-root_side-panel-button",3,"routerLink",4,"ngIf"],["class","game-root_side-panel-button",3,"routerLink",4,"ngFor","ngForOf"],["class","game-root_side-panel-button",3,"routerLink","queryParams",4,"ngIf"],[1,"game-root_side-panel-button",3,"routerLink"],["appearance","custom","tuiButton","","type","button",3,"click"],[1,"game-root_side-panel-button",3,"routerLink","queryParams"],["appearance","custom","tuiButton","","type","button",1,"game-root_side-panel-button",3,"click"],[3,"innerHTML"],["size","m","tuiButton","","appearance","custom","type","button",3,"click"]],template:function(n,o){if(n&1){let f=h();l(0,"div",4,0),v(2,Je,1,0,"ng-container",5),u(),v(3,nt,13,8,"ng-template",null,1,M)(5,ct,6,5,"ng-template",null,2,M)(7,lt,3,1,"ng-template",null,3,M),l(9,"router-outlet",6),_("activate",function(){return m(f),p(o.routerActivate())}),u()}if(n&2){let f=y(4),C=y(6);c(2),r("ngIf",o.isMobile)("ngIfThen",C)("ngIfElse",f)}},dependencies:[ge,de,_e,ve,ke,Ee,Be,F,Pe,Ge,He,Re,Le,Me,Ve,H,L],encapsulation:2});let t=a;return t})();export{$t as GameRootComponent};
